<mat-toolbar color="primary" class="topbar">
  <span>{{ title }}</span>
  <span class="spacer"></span>
  <button mat-button (click)="list()">Ver ruletas</button>
</mat-toolbar>

<div class="container">
  <div class="grid">

    <!-- Acciones -->
    <mat-card class="card">
      <mat-card-title>Acciones</mat-card-title>
      <mat-card-subtitle *ngIf="rid">
        RID: {{ rid }}
        <span class="badge" [class.open]="isOpen" [class.closed]="!isOpen">
          {{ isOpen ? 'Abierta' : 'Cerrada' }}
        </span>
      </mat-card-subtitle>

      <mat-card-content>

        <div class="actions">
          <button mat-raised-button color="primary" (click)="create()" [disabled]="loading">Crear ruleta</button>
          <button mat-raised-button color="accent"  (click)="open()"  [disabled]="!rid || loading">Abrir</button>
          <button mat-raised-button color="warn"    (click)="close()" [disabled]="!rid || !isOpen || loading">Cerrar</button>
        </div>

        <h3>Apostar número</h3>
        <form [formGroup]="numberBetForm" class="form-inline" (ngSubmit)="betNumber()">
          <mat-form-field appearance="outline">
            <mat-label>Monto</mat-label>
            <input matInput type="number" formControlName="amount" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Número (0-36)</mat-label>
            <input matInput type="number" formControlName="number" />
          </mat-form-field>

          <button mat-flat-button color="primary"
                  [disabled]="numberBetForm.invalid || !rid || !isOpen || loading">
            Apostar número
          </button>
        </form>

        <h3>Apostar color</h3>
        <form [formGroup]="colorBetForm" class="form-inline" (ngSubmit)="betColor()">
          <mat-form-field appearance="outline">
            <mat-label>Monto</mat-label>
            <input matInput type="number" formControlName="amount" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Color</mat-label>
            <mat-select formControlName="color">
              <mat-option value="rojo">Rojo</mat-option>
              <mat-option value="negro">Negro</mat-option>
            </mat-select>
          </mat-form-field>

          <button mat-flat-button color="primary"
                  [disabled]="colorBetForm.invalid || !rid || !isOpen || loading">
            Apostar color
          </button>
        </form>

        <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>
      </mat-card-content>
    </mat-card>

    
    <mat-card class="card result-card">
      <mat-card-title>Resultado</mat-card-title>
      <mat-card-content>
        <ng-container *ngIf="lastResult; else noResult">
          <div class="result-header">
            <div class="ball" [class.red]="winnerColor==='rojo'" [class.black]="winnerColor==='negro'">
              {{ winnerNumber }}
            </div>
            <div class="result-text">
              <div class="winner-line">
                Ganó
                <span class="chip" [class.red]="winnerColor==='rojo'" [class.black]="winnerColor==='negro'">
                  {{ winnerColor | titlecase }}
                </span>
                con el número <strong>{{ winnerNumber }}</strong>
              </div>
              <div class="muted">RID: {{ lastResult.id }}</div>
            </div>
          </div>

          <mat-divider class="my-16"></mat-divider>

          <div class="buttons">
            <button mat-stroked-button (click)="showJson = !showJson">
              {{ showJson ? 'Ocultar detalle JSON' : 'Ver detalle JSON' }}
            </button>
          </div>

          <div *ngIf="showJson" class="json-panel">
            <pre>{{ lastResult | json }}</pre>
          </div>
        </ng-container>

        <ng-template #noResult>
          <div class="empty">Aún no se ha cerrado una ruleta.</div>
        </ng-template>
      </mat-card-content>
    </mat-card>

    <!-- Lista de ruletas -->
    <mat-card class="card">
      <mat-card-title>Ruletas</mat-card-title>
      <mat-card-content>
        <div class="list-actions">
          <button mat-stroked-button (click)="list()">Listar</button>
        </div>
        <table class="data" *ngIf="data?.length; else emptyList">
          <thead>
            <tr>
              <th>ID</th>
              <th>Estado</th>
              <th>Apuestas</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of data">
              <td>{{ r.id }}</td>
              <td>
                <span class="chip" [class.red]="r.status==='closed'" [class.black]="r.status==='open'">
                  {{ r.status }}
                </span>
              </td>
              <td>{{ r.totalBets ?? 0 }}</td>
            </tr>
          </tbody>
        </table>
        <ng-template #emptyList>
          <div class="empty">No hay ruletas para mostrar.</div>
        </ng-template>
      </mat-card-content>
    </mat-card>

  </div>
</div>


